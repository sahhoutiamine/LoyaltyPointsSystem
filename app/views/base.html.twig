<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Loyalty System{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        primary: '#4F46E5', // Indigo 600
                        secondary: '#EC4899', // Pink 500
                        dark: '#0F172A', // Slate 900
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .glass {
                @apply bg-white/70 backdrop-blur-md border border-white/20 shadow-lg;
            }
            .glass-dark {
                @apply bg-slate-900/80 backdrop-blur-md border border-slate-700/50 shadow-xl;
            }
            .card-hover {
                @apply transition-all duration-300 hover:-translate-y-2 hover:shadow-2xl;
            }
        }
        
        body {
            @apply bg-slate-50 text-slate-800 antialiased;
            background-image: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            background-size: cover;
            background-attachment: fixed;
            min-height: 100vh;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="fixed w-full z-50 glass top-0 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center">
                    <a href="/" class="flex items-center gap-2 group">
                        <div class="bg-gradient-to-r from-primary to-secondary text-white p-2 rounded-lg shadow-lg group-hover:scale-110 transition-transform">
                            <i class="fa-solid fa-gem text-xl"></i>
                        </div>
                        <span class="font-bold text-2xl tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">LoyaltyPlus</span>
                    </a>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="/" class="text-slate-600 hover:text-primary font-medium transition-colors">Accueil</a>
                    {% if session.user_id %}
                        <a href="/shop" class="text-slate-600 hover:text-primary font-medium transition-colors">Boutique</a>
                        <a href="/rewards" class="text-slate-600 hover:text-primary font-medium transition-colors">Récompenses</a>
                        
                        <a href="/shop/cart" class="relative group">
                            <div class="p-2 rounded-full hover:bg-slate-100 transition-colors">
                                <i class="fa-solid fa-cart-shopping text-slate-600 group-hover:text-primary transition-colors text-lg"></i>
                                {% if cart_count > 0 %}
                                    <span class="absolute -top-1 -right-1 bg-secondary text-white text-xs font-bold h-5 w-5 flex items-center justify-center rounded-full shadow-md animate-bounce">{{ cart_count }}</span>
                                {% endif %}
                            </div>
                        </a>
                        
                        <div class="relative group ml-4">
                            <button class="flex items-center gap-2 bg-slate-100 hover:bg-slate-200 px-4 py-2 rounded-full transition-all">
                                <div class="bg-gradient-to-tr from-primary to-secondary h-8 w-8 rounded-full flex items-center justify-center text-white shadow-sm">
                                    <span class="font-bold text-sm">{{ session.user_name|slice(0,1)|upper }}</span>
                                </div>
                                <span class="font-medium text-slate-700">{{ session.user_name }}</span>
                                <i class="fa-solid fa-chevron-down text-xs text-slate-400"></i>
                            </button>
                            
                            <!-- Dropdown -->
                            <div class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-2xl border border-slate-100 overflow-hidden opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all transform origin-top-right z-50">
                                <a href="/logout" class="block px-4 py-3 text-slate-600 hover:bg-slate-50 hover:text-red-500 transition-colors">
                                    <i class="fa-solid fa-arrow-right-from-bracket mr-2"></i> Déconnexion
                                </a>
                            </div>
                        </div>
                    {% else %}
                        <a href="/login" class="text-slate-600 hover:text-primary font-medium transition-colors">Connexion</a>
                        <a href="/register" class="bg-slate-900 text-white px-5 py-2.5 rounded-full font-medium hover:bg-slate-800 hover:shadow-lg hover:-translate-y-0.5 transition-all">Inscription</a>
                    {% endif %}
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden flex items-center">
                    <button id="mobile-menu-btn" class="text-slate-600 hover:text-primary focus:outline-none">
                        <i class="fa-solid fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-slate-100 fixed w-full top-20 left-0 h-screen z-40 p-4 transform transition-transform">
             <div class="flex flex-col space-y-4">
                 <a href="/" class="text-lg font-medium text-slate-700 py-2 border-b border-slate-50">Accueil</a>
                 {% if session.user_id %}
                    <a href="/shop" class="text-lg font-medium text-slate-700 py-2 border-b border-slate-50">Boutique</a>
                    <a href="/rewards" class="text-lg font-medium text-slate-700 py-2 border-b border-slate-50">Récompenses</a>
                    <a href="/shop/cart" class="text-lg font-medium text-slate-700 py-2 border-b border-slate-50">Panier ({{ cart_count }})</a>
                    <a href="/logout" class="text-lg font-medium text-red-500 py-2">Déconnexion</a>
                 {% else %}
                    <a href="/login" class="text-lg font-medium text-slate-700 py-2 border-b border-slate-50">Connexion</a>
                    <a href="/register" class="text-lg font-medium text-primary py-2">Inscription</a>
                 {% endif %}
             </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow pt-28 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto w-full">
        <!-- Decoration Blur -->
        <div class="fixed top-20 left-10 w-72 h-72 bg-primary/20 rounded-full blur-3xl -z-10 animate-pulse"></div>
        <div class="fixed bottom-20 right-10 w-96 h-96 bg-secondary/10 rounded-full blur-3xl -z-10"></div>
        
        <div class="fade-in">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="glass mt-auto py-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-slate-500 text-sm">© {{ 'now'|date('Y') }} LoyaltyPlus. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Mobile Menu Toggle
        const btn = document.getElementById('mobile-menu-btn');
        const menu = document.getElementById('mobile-menu');
        
        if(btn) {
            btn.addEventListener('click', () => {
                menu.classList.toggle('hidden');
                const icon = btn.querySelector('i');
                if (menu.classList.contains('hidden')) {
                    icon.classList.remove('fa-xmark');
                    icon.classList.add('fa-bars');
                } else {
                     icon.classList.remove('fa-bars');
                     icon.classList.add('fa-xmark');
                }
            });
        }
        
        // Navbar Scrolled State
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 10) {
                nav.classList.add('shadow-md');
                nav.classList.replace('bg-white/70', 'bg-white/90');
            } else {
                nav.classList.remove('shadow-md');
                nav.classList.replace('bg-white/90', 'bg-white/70');
            }
        });
    </script>
</body>
</html>
